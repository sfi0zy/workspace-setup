" start pathogen

execute pathogen#infect()
call pathogen#helptags()

function FindSessionDirectory() abort
    if len(argv()) > 0
        return fnamemodify(argv()[0], ':p:h')
    endif
    return getcwd()
endfunction!

" set fallback settings for tabs and line endings (before editorconfig)

set tabstop=4
set shiftwidth=4
set expandtab
autocmd BufWritePre * set ff=unix
autocmd BufWritePre * %s/\s\+$//e

" set color for vertical lines (indentations)

let g:indentLine_color_term = 236

" show line numbers by default

set nu

" open NERDTree automatically when vim starts up

autocmd vimenter * NERDTree
let NERDTreeShowHidden = 1

" set the current directory to skip %:h/ in the commands

:set autochdir

" enable syntax highlighting by default

syntax on

" disable highlighting on long lines (improves performance, can cause
" wrong highlighting in the next lines)

set synmaxcol=120

" apply colorscheme

colorscheme atlantic-dark
let g:airline_theme='term'

" fill columns 80+ (saving join here for future tests)

highlight ColorColumn ctermbg=232 guibg=#060606
let &colorcolumn="80,".join(range(81,999),",")

" highlight search results

set hlsearch
set incsearch

" highlight parens

set showmatch

" highlight ES6 template strings

hi link javaScriptTemplateDelim  String
hi link javaScriptTemplateVar    Text
hi link javaScriptTemplateString String

" now hyphens are part of identifiers

au! FileType css,less,html setl iskeyword+=-

" enable code completion

filetype plugin on
autocmd FileType javascript set omnifunc=javascriptcomplete#CompleteJS
autocmd FileType html       set omnifunc=htmlcomplete#CompleteTags
autocmd FileType css        set omnifunc=csscomplete#CompleteCSS

" activate omni on Tab

function! TabOrComplete()
    if col('.')>1 && strpart( getline('.'), col('.')-2, 3 ) =~ '^\w'
        return "\<C-X>\<C-O>"
    else
        return "\<Tab>"
    endif
endfunction

inoremap <Tab> <C-R>=TabOrComplete()<CR>

" activate wildmenu

set wildmenu

" change default trigger key for emmet

let g:user_emmet_leader_key = '<C-Z>'

" disable auto comments

autocmd FileType * setlocal formatoptions-=c formatoptions-=r formatoptions-=o

" disable crazy syntax highlighting for json and markdown files

autocmd FileType json     setlocal syntax=off nospell
autocmd FileType markdown setlocal syntax=off nospell

" settings for ALE

let g:ale_lint_on_enter = 1
let g:ale_lint_on_save = 1

let g:ale_linters = {
\   'css': ['stylelint'],
\   'less': ['stylelint'],
\   'javascript': ['eslint'],
\}
let g:ale_linters_explicit = 1

let g:ale_echo_msg_error_str = 'Error'
let g:ale_echo_msg_warning_str = 'Warning'
let g:ale_echo_msg_format = '[%severity%][%linter%] %s'

let g:ale_sign_column_always = 1
let g:ale_set_highlights = 0
